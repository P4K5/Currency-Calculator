<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <style>
            *
            {
                text-align: center;
                background-color: rgb(223, 223, 223);
                margin-top: 2%;
                font-family: 'Apple Chancery', cursive;
            }
            input, select
            {
                border-radius: 12px;
                background-color: whitesmoke;
            }
        </style>
    </head>
    <body onload="main()">
        <form action="" name="przelicznik">
            Co chcesz przeliczyć:
            <input type="number" value="1.00" name="ile" step="0.01" onchange="(function(a){a.value = parseFloat(a.value).toFixed(2); przelicz()})(this)"/>
            <select name="co" onchange="przelicz()"></select><br><br>
            Na co chcesz przeliczyć:
            <input type="number" value="1.00" name="wynik" disabled="disabled"/>
            <select name="naCo" onchange="przelicz()"></select>
        </form><br>
        <script>
            var co, naCo, coCode, naCoCode;

            function main()
            {
                var waluty = ["PLN", "EUR", "USD", "GBP", "RUB", "JPY", "CZK"];
                var htmlSelect = "";
                waluty.forEach(item => {
                    htmlSelect += "<option value=\"" + item + "\">" + item + "</option>";
                });
                przelicznik.co.innerHTML = htmlSelect;
                przelicznik.naCo.innerHTML = htmlSelect;
            }

            function przelicz()
            {
                try
                {
                    if (coCode != przelicznik.co.value)
                    {
                        co = setValue(przelicznik.co.value);
                        coCode = przelicznik.co.value;
                    }
                    if (naCoCode != przelicznik.naCo.value)
                    {
                        naCo = setValue(przelicznik.naCo.value);
                        naCoCode = przelicznik.naCo.value;
                    }
                    przelicznik.wynik.value = (przelicznik.ile.value*co/naCo).toFixed(2);
                }
                catch(e)
                {
                    alert("Wystąpił błąd.\nSprawdź połączenie z internetem.\n\n" + e);
                    console.error(e);
                    przelicznik.wynik.value = 0;
                }
            }

            function setValue(waluta)
            {
                if(waluta == "PLN")
                {
                    return 1;
                }
                var req = new XMLHttpRequest();
                req.open("GET", "http://api.nbp.pl/api/exchangerates/rates/a/" + waluta, false);
                req.send();
                return JSON.parse(req.responseText).rates[0].mid;
            }
        </script>
    </body>
</html>